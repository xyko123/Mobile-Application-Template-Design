<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fun Run Marathon</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Outfit', sans-serif;
    }
    
    .gradient-bg {
      background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 50%, #FED766 100%);
    }
    
    .card-gradient {
      background: linear-gradient(180deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.9) 100%);
    }
    
    .bounce-in {
      animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }
    
    @keyframes bounceIn {
      0% { transform: scale(0.3); opacity: 0; }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); opacity: 1; }
    }
    
    .slide-up {
      animation: slideUp 0.5s ease-out forwards;
    }
    
    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .pulse-ring {
      animation: pulseRing 2s infinite;
    }
    
    @keyframes pulseRing {
      0% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0.4); }
      70% { box-shadow: 0 0 0 15px rgba(255, 107, 107, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 107, 107, 0); }
    }
    
    .runner-icon {
      animation: run 0.8s infinite alternate;
    }
    
    @keyframes run {
      0% { transform: translateX(-3px) rotate(-5deg); }
      100% { transform: translateX(3px) rotate(5deg); }
    }
    
    .tab-active {
      background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
    }
    
    .event-card {
      transition: all 0.3s ease;
    }
    
    .event-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
    }
    
    .registration-badge {
      background: linear-gradient(135deg, #10B981 0%, #34D399 100%);
    }
    
    .confetti {
      position: fixed;
      pointer-events: none;
      z-index: 1000;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full">
  <div id="app" class="h-full w-full gradient-bg overflow-auto"><!-- Header -->
   <header class="sticky top-0 z-50 backdrop-blur-lg bg-white/80 shadow-sm">
    <div class="px-4 py-3 flex items-center justify-between">
     <div class="flex items-center gap-2">
      <div class="w-10 h-10 rounded-xl gradient-bg flex items-center justify-center shadow-lg"><span class="text-xl runner-icon">ğŸƒ</span>
      </div>
      <h1 id="app-title" class="text-xl font-bold bg-gradient-to-r from-red-500 to-orange-500 bg-clip-text text-transparent">Fun Run</h1>
     </div>
     <div class="flex items-center gap-2"><button id="my-runs-btn" class="px-3 py-2 rounded-full text-sm font-semibold text-gray-600 hover:bg-gray-100 transition-all flex items-center gap-1"> <span>ğŸ«</span> <span id="registration-count" class="bg-red-500 text-white text-xs rounded-full px-2 py-0.5 hidden">0</span> </button>
     </div>
    </div>
   </header><!-- Main Content -->
   <main class="pb-24"><!-- Hero Section -->
    <section id="hero-section" class="px-4 pt-6 pb-8">
     <div class="card-gradient rounded-3xl p-6 shadow-2xl bounce-in">
      <div class="flex items-center gap-4">
       <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-yellow-400 to-orange-500 flex items-center justify-center shadow-lg pulse-ring"><span class="text-4xl">ğŸ…</span>
       </div>
       <div class="flex-1">
        <p class="text-sm text-orange-500 font-semibold uppercase tracking-wide">Next Event</p>
        <h2 class="text-xl font-bold text-gray-800">Sunshine 5K</h2>
        <p id="hero-subtitle" class="text-sm text-gray-500">June 15, 2025 â€¢ City Park</p>
       </div>
      </div>
      <div class="mt-4 flex items-center justify-between">
       <div class="flex -space-x-2">
        <div class="w-8 h-8 rounded-full bg-pink-400 border-2 border-white flex items-center justify-center text-xs">
         ğŸ˜Š
        </div>
        <div class="w-8 h-8 rounded-full bg-blue-400 border-2 border-white flex items-center justify-center text-xs">
         ğŸ˜„
        </div>
        <div class="w-8 h-8 rounded-full bg-green-400 border-2 border-white flex items-center justify-center text-xs">
         ğŸ¤©
        </div>
        <div class="w-8 h-8 rounded-full bg-gray-200 border-2 border-white flex items-center justify-center text-xs font-semibold text-gray-600">
         +42
        </div>
       </div><button id="hero-cta" class="px-5 py-2.5 rounded-full gradient-bg text-white font-semibold shadow-lg hover:shadow-xl transition-all transform hover:scale-105"> Join Now ğŸ‰ </button>
      </div>
     </div>
    </section><!-- Category Tabs -->
    <section class="px-4 mb-4">
     <div id="category-tabs" class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide"><button data-category="all" class="tab-btn px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap tab-active">All Events</button> <button data-category="5k" class="tab-btn px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap bg-white/80 text-gray-600">5K</button> <button data-category="10k" class="tab-btn px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap bg-white/80 text-gray-600">10K</button> <button data-category="half" class="tab-btn px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap bg-white/80 text-gray-600">Half Marathon</button> <button data-category="full" class="tab-btn px-4 py-2 rounded-full text-sm font-semibold whitespace-nowrap bg-white/80 text-gray-600">Full Marathon</button>
     </div>
    </section><!-- Events List -->
    <section class="px-4">
     <h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2"><span>ğŸ“…</span> Upcoming Events</h3>
     <div id="events-list" class="space-y-4"><!-- Events will be rendered here -->
     </div>
    </section>
   </main><!-- Registration Modal -->
   <div id="registration-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="modal-backdrop"></div>
    <div class="absolute inset-x-4 bottom-0 top-auto max-h-[85%] overflow-auto">
     <div class="bg-white rounded-t-3xl shadow-2xl slide-up">
      <div class="p-6">
       <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
       <h3 id="modal-title" class="text-xl font-bold text-gray-800 mb-2">Register for Event</h3>
       <p id="modal-event-info" class="text-sm text-gray-500 mb-4"></p>
       <form id="registration-form" class="space-y-4"><input type="hidden" id="event-id">
        <div><label class="block text-sm font-semibold text-gray-700 mb-1">Your Name</label> <input type="text" id="participant-name" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400 focus:outline-none transition-colors" placeholder="Enter your name">
        </div>
        <div><label class="block text-sm font-semibold text-gray-700 mb-1">Category</label> <select id="run-category" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-orange-400 focus:outline-none transition-colors"> <option value="">Select category</option> <option value="open">Open (All ages)</option> <option value="youth">Youth (Under 18)</option> <option value="senior">Senior (50+)</option> <option value="elite">Elite Runner</option> </select>
        </div><button type="submit" id="submit-btn" class="w-full py-4 rounded-xl gradient-bg text-white font-bold text-lg shadow-lg hover:shadow-xl transition-all transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed"> Complete Registration ğŸŠ </button>
       </form>
      </div>
     </div>
    </div>
   </div><!-- My Registrations Modal -->
   <div id="my-runs-modal" class="fixed inset-0 z-50 hidden">
    <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="my-runs-backdrop"></div>
    <div class="absolute inset-x-4 bottom-0 top-auto max-h-[85%] overflow-auto">
     <div class="bg-white rounded-t-3xl shadow-2xl slide-up">
      <div class="p-6">
       <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
       <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2"><span>ğŸ«</span> My Registrations</h3>
       <div id="my-registrations-list" class="space-y-3"><!-- Registrations will be rendered here -->
       </div>
      </div>
     </div>
    </div>
   </div><!-- Bottom Navigation -->
   <nav class="fixed bottom-0 inset-x-0 bg-white/95 backdrop-blur-lg border-t border-gray-100 px-6 py-3 z-40">
    <div class="flex justify-around items-center"><button class="flex flex-col items-center gap-1 text-orange-500">
      <svg class="w-6 h-6" fill="currentColor" viewbox="0 0 24 24">
       <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
      </svg><span class="text-xs font-semibold">Home</span> </button> <button class="flex flex-col items-center gap-1 text-gray-400">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
      </svg><span class="text-xs font-semibold">Explore</span> </button> <button class="flex flex-col items-center gap-1 text-gray-400">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
      </svg><span class="text-xs font-semibold">Stats</span> </button> <button class="flex flex-col items-center gap-1 text-gray-400">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
      </svg><span class="text-xs font-semibold">Profile</span> </button>
    </div>
   </nav>
  </div>
  <script>
    // Reference events data
    const eventsData = [
      { id: 'evt1', name: 'Sunshine 5K', date: 'June 15, 2025', location: 'City Park', category: '5k', distance: '5K', emoji: 'â˜€ï¸', color: 'from-yellow-400 to-orange-500', participants: 45, price: 'Free' },
      { id: 'evt2', name: 'Night Owl 10K', date: 'June 22, 2025', location: 'Riverside Trail', category: '10k', distance: '10K', emoji: 'ğŸ¦‰', color: 'from-indigo-500 to-purple-600', participants: 78, price: '$15' },
      { id: 'evt3', name: 'Rainbow Run', date: 'July 1, 2025', location: 'Downtown', category: '5k', distance: '5K', emoji: 'ğŸŒˆ', color: 'from-pink-500 to-rose-500', participants: 120, price: '$10' },
      { id: 'evt4', name: 'Mountain Half', date: 'July 10, 2025', location: 'Summit Trail', category: 'half', distance: '21K', emoji: 'â›°ï¸', color: 'from-emerald-500 to-teal-600', participants: 35, price: '$25' },
      { id: 'evt5', name: 'City Marathon', date: 'July 20, 2025', location: 'City Center', category: 'full', distance: '42K', emoji: 'ğŸ™ï¸', color: 'from-blue-500 to-cyan-500', participants: 200, price: '$40' },
      { id: 'evt6', name: 'Beach Blast 10K', date: 'August 5, 2025', location: 'Ocean Boulevard', category: '10k', distance: '10K', emoji: 'ğŸ–ï¸', color: 'from-cyan-400 to-blue-500', participants: 65, price: '$20' },
    ];

    // Default config
    const defaultConfig = {
      app_title: 'Fun Run',
      hero_subtitle: 'June 15, 2025 â€¢ City Park',
      cta_button_text: 'Join Now ğŸ‰',
      primary_color: '#FF6B6B',
      secondary_color: '#FFFFFF',
      text_color: '#1F2937',
      accent_color: '#FF8E53',
      surface_color: '#FED766',
      font_family: 'Outfit',
      font_size: 16
    };

    let config = { ...defaultConfig };
    let userRegistrations = [];
    let currentFilter = 'all';

    // Data handler for SDK
    const dataHandler = {
      onDataChanged(data) {
        userRegistrations = data;
        updateRegistrationCount();
        renderEvents();
        renderMyRegistrations();
      }
    };

    // Initialize app
    async function initApp() {
      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (newConfig) => {
            config = { ...defaultConfig, ...newConfig };
            applyConfig();
          },
          mapToCapabilities: (cfg) => ({
            recolorables: [
              { get: () => cfg.primary_color || defaultConfig.primary_color, set: (v) => { cfg.primary_color = v; window.elementSdk.setConfig({ primary_color: v }); } },
              { get: () => cfg.secondary_color || defaultConfig.secondary_color, set: (v) => { cfg.secondary_color = v; window.elementSdk.setConfig({ secondary_color: v }); } },
              { get: () => cfg.text_color || defaultConfig.text_color, set: (v) => { cfg.text_color = v; window.elementSdk.setConfig({ text_color: v }); } },
              { get: () => cfg.accent_color || defaultConfig.accent_color, set: (v) => { cfg.accent_color = v; window.elementSdk.setConfig({ accent_color: v }); } },
              { get: () => cfg.surface_color || defaultConfig.surface_color, set: (v) => { cfg.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); } }
            ],
            borderables: [],
            fontEditable: { get: () => cfg.font_family || defaultConfig.font_family, set: (v) => { cfg.font_family = v; window.elementSdk.setConfig({ font_family: v }); } },
            fontSizeable: { get: () => cfg.font_size || defaultConfig.font_size, set: (v) => { cfg.font_size = v; window.elementSdk.setConfig({ font_size: v }); } }
          }),
          mapToEditPanelValues: (cfg) => new Map([
            ['app_title', cfg.app_title || defaultConfig.app_title],
            ['hero_subtitle', cfg.hero_subtitle || defaultConfig.hero_subtitle],
            ['cta_button_text', cfg.cta_button_text || defaultConfig.cta_button_text]
          ])
        });
        config = { ...defaultConfig, ...window.elementSdk.config };
      }

      // Initialize Data SDK
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize data SDK');
        }
      }

      applyConfig();
      renderEvents();
      setupEventListeners();
    }

    function applyConfig() {
      const font = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;

      document.body.style.fontFamily = `${font}, sans-serif`;
      
      // Apply text content
      document.getElementById('app-title').textContent = config.app_title || defaultConfig.app_title;
      document.getElementById('hero-subtitle').textContent = config.hero_subtitle || defaultConfig.hero_subtitle;
      document.getElementById('hero-cta').textContent = config.cta_button_text || defaultConfig.cta_button_text;

      // Apply font sizes
      document.getElementById('app-title').style.fontSize = `${baseSize * 1.25}px`;
      document.querySelectorAll('h2').forEach(el => el.style.fontSize = `${baseSize * 1.25}px`);
      document.querySelectorAll('h3').forEach(el => el.style.fontSize = `${baseSize * 1.125}px`);
      document.querySelectorAll('p, span, button').forEach(el => {
        if (!el.classList.contains('text-xs') && !el.classList.contains('text-sm')) {
          el.style.fontSize = `${baseSize}px`;
        }
      });

      // Apply colors via CSS custom properties
      document.documentElement.style.setProperty('--primary-color', primaryColor);
      document.documentElement.style.setProperty('--secondary-color', secondaryColor);
      document.documentElement.style.setProperty('--text-color', textColor);
      document.documentElement.style.setProperty('--accent-color', accentColor);

      // Update gradient backgrounds
      const gradientElements = document.querySelectorAll('.gradient-bg');
      gradientElements.forEach(el => {
        el.style.background = `linear-gradient(135deg, ${primaryColor} 0%, ${accentColor} 50%, ${config.surface_color || defaultConfig.surface_color} 100%)`;
      });

      // Update text colors
      document.querySelectorAll('.text-gray-800').forEach(el => el.style.color = textColor);
    }

    function renderEvents() {
      const container = document.getElementById('events-list');
      const filteredEvents = currentFilter === 'all' 
        ? eventsData 
        : eventsData.filter(e => e.category === currentFilter);

      container.innerHTML = filteredEvents.map((event, index) => {
        const isRegistered = userRegistrations.some(r => r.event_id === event.id);
        return `
          <div class="event-card card-gradient rounded-2xl p-4 shadow-lg slide-up" style="animation-delay: ${index * 0.1}s">
            <div class="flex items-start gap-4">
              <div class="w-16 h-16 rounded-xl bg-gradient-to-br ${event.color} flex items-center justify-center shadow-md flex-shrink-0">
                <span class="text-2xl">${event.emoji}</span>
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2 mb-1">
                  <h4 class="font-bold text-gray-800 truncate">${event.name}</h4>
                  ${isRegistered ? '<span class="registration-badge text-white text-xs px-2 py-0.5 rounded-full">âœ“ Registered</span>' : ''}
                </div>
                <p class="text-sm text-gray-500 mb-2">${event.date} â€¢ ${event.location}</p>
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-3">
                    <span class="text-xs font-semibold px-2 py-1 rounded-full bg-orange-100 text-orange-600">${event.distance}</span>
                    <span class="text-xs text-gray-400">ğŸ‘¥ ${event.participants} joined</span>
                  </div>
                  <span class="text-sm font-bold text-green-600">${event.price}</span>
                </div>
              </div>
            </div>
            <button 
              onclick="openRegistration('${event.id}')" 
              class="w-full mt-4 py-3 rounded-xl font-semibold transition-all ${isRegistered 
                ? 'bg-gray-100 text-gray-400 cursor-not-allowed' 
                : 'bg-gradient-to-r from-orange-400 to-pink-500 text-white shadow-md hover:shadow-lg transform hover:scale-[1.02]'}"
              ${isRegistered ? 'disabled' : ''}
            >
              ${isRegistered ? 'Already Registered âœ“' : 'Register Now â†’'}
            </button>
          </div>
        `;
      }).join('');
    }

    function renderMyRegistrations() {
      const container = document.getElementById('my-registrations-list');
      
      if (userRegistrations.length === 0) {
        container.innerHTML = `
          <div class="text-center py-8">
            <span class="text-4xl mb-2 block">ğŸƒâ€â™‚ï¸</span>
            <p class="text-gray-500">No registrations yet</p>
            <p class="text-sm text-gray-400">Join an event to get started!</p>
          </div>
        `;
        return;
      }

      container.innerHTML = userRegistrations.map(reg => {
        const event = eventsData.find(e => e.id === reg.event_id);
        if (!event) return '';
        return `
          <div class="bg-gray-50 rounded-xl p-4 flex items-center gap-4">
            <div class="w-12 h-12 rounded-lg bg-gradient-to-br ${event.color} flex items-center justify-center">
              <span class="text-xl">${event.emoji}</span>
            </div>
            <div class="flex-1">
              <h4 class="font-semibold text-gray-800">${event.name}</h4>
              <p class="text-xs text-gray-500">${reg.participant_name} â€¢ ${reg.category}</p>
            </div>
            <button onclick="cancelRegistration('${reg.__backendId}')" class="text-red-400 hover:text-red-600 p-2 rounded-full hover:bg-red-50 transition-colors">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
            </button>
          </div>
        `;
      }).join('');
    }

    function updateRegistrationCount() {
      const countEl = document.getElementById('registration-count');
      if (userRegistrations.length > 0) {
        countEl.textContent = userRegistrations.length;
        countEl.classList.remove('hidden');
      } else {
        countEl.classList.add('hidden');
      }
    }

    function openRegistration(eventId) {
      const event = eventsData.find(e => e.id === eventId);
      if (!event) return;

      document.getElementById('event-id').value = eventId;
      document.getElementById('modal-title').textContent = `Register for ${event.name}`;
      document.getElementById('modal-event-info').textContent = `${event.date} â€¢ ${event.location} â€¢ ${event.distance}`;
      document.getElementById('registration-modal').classList.remove('hidden');
    }

    function closeRegistration() {
      document.getElementById('registration-modal').classList.add('hidden');
      document.getElementById('registration-form').reset();
    }

    function openMyRuns() {
      document.getElementById('my-runs-modal').classList.remove('hidden');
    }

    function closeMyRuns() {
      document.getElementById('my-runs-modal').classList.add('hidden');
    }

    async function cancelRegistration(backendId) {
      const reg = userRegistrations.find(r => r.__backendId === backendId);
      if (!reg || !window.dataSdk) return;

      const result = await window.dataSdk.delete(reg);
      if (!result.isOk) {
        console.error('Failed to cancel registration');
      }
    }

    function createConfetti() {
      const colors = ['#FF6B6B', '#FF8E53', '#FED766', '#10B981', '#6366F1'];
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.cssText = `
          position: fixed;
          width: ${Math.random() * 10 + 5}px;
          height: ${Math.random() * 10 + 5}px;
          background: ${colors[Math.floor(Math.random() * colors.length)]};
          left: ${Math.random() * 100}vw;
          top: -20px;
          border-radius: ${Math.random() > 0.5 ? '50%' : '0'};
          animation: confettiFall ${Math.random() * 2 + 2}s linear forwards;
        `;
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 4000);
      }

      const style = document.createElement('style');
      style.textContent = `
        @keyframes confettiFall {
          to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
    }

    function setupEventListeners() {
      // Category tabs
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tab-btn').forEach(b => {
            b.classList.remove('tab-active');
            b.classList.add('bg-white/80', 'text-gray-600');
          });
          btn.classList.add('tab-active');
          btn.classList.remove('bg-white/80', 'text-gray-600');
          currentFilter = btn.dataset.category;
          renderEvents();
        });
      });

      // Hero CTA
      document.getElementById('hero-cta').addEventListener('click', () => {
        openRegistration('evt1');
      });

      // My runs button
      document.getElementById('my-runs-btn').addEventListener('click', openMyRuns);

      // Modal backdrops
      document.getElementById('modal-backdrop').addEventListener('click', closeRegistration);
      document.getElementById('my-runs-backdrop').addEventListener('click', closeMyRuns);

      // Registration form
      document.getElementById('registration-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        if (userRegistrations.length >= 999) {
          const form = e.target;
          const warning = document.createElement('p');
          warning.className = 'text-red-500 text-sm text-center mt-2';
          warning.textContent = 'Maximum registrations reached. Please cancel some to add more.';
          form.appendChild(warning);
          setTimeout(() => warning.remove(), 3000);
          return;
        }

        const submitBtn = document.getElementById('submit-btn');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Registering...';

        const registration = {
          event_id: document.getElementById('event-id').value,
          participant_name: document.getElementById('participant-name').value,
          category: document.getElementById('run-category').value,
          registered_at: new Date().toISOString()
        };

        if (window.dataSdk) {
          const result = await window.dataSdk.create(registration);
          if (result.isOk) {
            createConfetti();
            closeRegistration();
          } else {
            console.error('Failed to register');
          }
        }

        submitBtn.disabled = false;
        submitBtn.textContent = 'Complete Registration ğŸŠ';
      });
    }

    // Initialize
    initApp();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9c1b5942112436f1',t:'MTc2OTA0NjA4My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
